\chapter{まとめと今後の課題}
本研究では，効率的コード生成に有用な技法であるlet挿入を，型安全に実現す
るための言語と型システムについて述べた．
局所的な代入可能変数を持つ体系に対する須藤らの研究\cite{Sudo2014}などに基づき，
多段階のforループを飛び越えたlet挿入を実現するために，shift0/reset0 を持つコード生成体系を設計した．
須藤らの研究で精密化された環境識別子(Environment Classifier)に join ($\cup$) を導入することで，
計算の順序を変更するようなコントロールオペレータ（shift0/reset0）を扱えるようにし，
安全に多段階の let挿入を行えるように型システムを構築した．
このようなlet挿入が束縛子を越えるケースは，ループにおける不変式の括り出
しなどの有用な最適化を含むが，これまでの研究では一般的なlet挿入を安全
に実現した体系の提案はなく，我々の知る限り本研究がはじめてである．

今後の課題として，まずあげられるのは，進行(Progress)の性質および型推論
アルゴリズムの実装の完成である．また，理論的には Kiselyovらのグローバルな参
照を持つ体系との融合が可能になれば，広い範囲のコード生成技法・最適化技法
をカバーできるため極めて有用である．
また，既存のMetaOCaml との比較においては，
2レベルのみのコード生成に限定している点や
run (生成したコードの実行)や cross-stage persistence (現在ス
テージの値をコードに埋め込む機能)などに対応していない点が欠点であり，
これらの拡張が可能であるかどうかの検討は非常に興味深い将来課題である．

2017年1月に，プログラミング言語 MetaOCaml の最新版である BER MetaOCaml が バージョンアップされ，コード生成時に自動的に let 挿入を行う genlet という式が導入された．
genlet は，動的に let 挿入を行う点，また，挿入先の選択において変数束縛の安全性を考慮している点，さらに，安全性が保たれる範囲でなるべくトップレベルに近い場所を探す点が特徴であり，人間が手動で let 挿入を行う場所を決めるより，手間が少なく，安全性を考慮しなくてよいなど，優れている点がある．
一方で， if 式や match 式 など条件分岐を行う式の生成では，let 挿入を if 式の外側まで持ち上げるべきか， if 式の内側でとどめておくべきかは，自動的に決まる問題ではなく，プログラマが選択する必要がある．そのような場合は，本研究で述べた通り， shift0/reset0 等のコントロールオペレータを用いて，プログラマが明示的に let挿入の位置を指定することになり，その安全性を保証する本研究が必要となる．
genlet は非常に有用なオペレータであるが，それ自身一種のコントロールオペレータであり，
本研究で述べた手動での let 挿入を行うためのコントロールオペレータと genlet をあわせもつコード生成器の安全性は，新たな将来課題である．

%%% Local Variables:
%%% mode: japanese-latex
%%% TeX-master: "master_oishi"
%%% End:
